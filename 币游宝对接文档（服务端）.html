<!DOCTYPE html> <html lang="zh"> <head> <meta charset="utf-8"/> <title>币游宝-对接文档</title> </head> <body><h1 id="h1-u5E01u6E38u5B9Du5BF9u63A5u6587u6863" style="text-align:center"><a name="币游宝对接文档" class="reference-link"></a><span class="header-link octicon octicon-link"></span>币游宝对接文档</h1><h2 id="h2-app-"><a name="APP授权登录" class="reference-link"></a><span class="header-link octicon octicon-link"></span>一、APP授权登录</h2><h3 id="h3-app-"><a name="APP授权登录时序图如下：" class="reference-link"></a><span class="header-link octicon octicon-link"></span>APP授权登录时序图如下：</h3><hr> <p style="text-align:center"><img src="https://biwan.wanlege.com/source/app/app-auth.jpg" alt="markdown" title="markdown"> </p><hr> <ul> <li>第8步，使用Code发起登录请求，此处需要第三方服务端实现登录接口;</li></ul> <p>1、接口入参如下：</p> <table> <thead> <tr> <th style="text-align:center">参数</th> <th style="text-align:center">类型</th> <th style="text-align:center">长度</th> <th style="text-align:center">是否必填</th> <th style="text-align:center">备注</th> </tr> </thead> <tbody> <tr> <td style="text-align:center">Code</td> <td style="text-align:center">String</td> <td style="text-align:center">16</td> <td style="text-align:center">是</td> <td style="text-align:center">登录验证码</td> </tr> </tbody> </table> <hr> <ul> <li>第9步，获取AccessToken</li></ul> <p>1、接口地址： <a href="https://biwan.wanlege.com/biwan/biwanUser/app/oauth2/access_token">https://biwan.wanlege.com/biwan/biwanUser/app/oauth2/access_token</a><br>2、请求方法： POST<br>3、请求参数 </p><table> <thead> <tr> <th style="text-align:center">参数</th> <th style="text-align:center">类型</th> <th style="text-align:center">长度</th> <th style="text-align:center">是否必填</th> <th style="text-align:center">备注</th> </tr> </thead> <tbody> <tr> <td style="text-align:center">AppID</td> <td style="text-align:center">INT</td> <td style="text-align:center">11</td> <td style="text-align:center">是</td> <td style="text-align:center">应用ID</td> </tr> <tr> <td style="text-align:center">AppKey</td> <td style="text-align:center">String</td> <td style="text-align:center">32</td> <td style="text-align:center">是</td> <td style="text-align:center">应用密码</td> </tr> <tr> <td style="text-align:center">Code</td> <td style="text-align:center">String</td> <td style="text-align:center">16</td> <td style="text-align:center">是</td> <td style="text-align:center">登录验证码</td> </tr> </tbody> </table> <p>4、返回参数</p> <ul> <li>code: 0成功，非0失败</li><li>mag: 返回结果描述</li><li>data 数据结构如下：</li></ul> <table> <thead> <tr> <th style="text-align:center">参数</th> <th style="text-align:center">类型</th> <th style="text-align:center">长度</th> <th style="text-align:center">是否必填</th> <th style="text-align:center">备注</th> </tr> </thead> <tbody> <tr> <td style="text-align:center">AccessToken</td> <td style="text-align:center">Object</td> <td style="text-align:center">-</td> <td style="text-align:center">是</td> <td style="text-align:center">AccessToken</td> </tr> <tr> <td style="text-align:center">TokenType</td> <td style="text-align:center">String</td> <td style="text-align:center">6</td> <td style="text-align:center">是</td> <td style="text-align:center">Bearer</td> </tr> <tr> <td style="text-align:center">ExpireTimeStamp</td> <td style="text-align:center">DATE</td> <td style="text-align:center">-</td> <td style="text-align:center">是</td> <td style="text-align:center">过期时间</td> </tr> <tr> <td style="text-align:center">scope</td> <td style="text-align:center">String</td> <td style="text-align:center">3</td> <td style="text-align:center">是</td> <td style="text-align:center">作用于范围 app</td> </tr> </tbody> </table> <hr> <ul> <li>第11步，获取用户信息</li></ul> <p>1、接口地址： <a href="https://biwan.wanlege.com/biwan/biwanUser/app/oauth2/user_info">https://biwan.wanlege.com/biwan/biwanUser/app/oauth2/user_info</a><br>2、请求方法： POST<br>3、请求参数 </p><table> <thead> <tr> <th style="text-align:center">参数</th> <th style="text-align:center">类型</th> <th style="text-align:center">长度</th> <th style="text-align:center">是否必填</th> <th style="text-align:center">备注</th> </tr> </thead> <tbody> <tr> <td style="text-align:center">AccessToken</td> <td style="text-align:center">Object</td> <td style="text-align:center">-</td> <td style="text-align:center">是</td> <td style="text-align:center">AccessToken</td> </tr> </tbody> </table> <p>4、返回参数</p> <ul> <li>code: 0成功，非0失败</li><li>mag: 返回结果描述</li><li>data 数据结构如下：</li></ul> <table> <thead> <tr> <th style="text-align:center">参数</th> <th style="text-align:center">类型</th> <th style="text-align:center">长度</th> <th style="text-align:center">是否必填</th> <th style="text-align:center">备注</th> </tr> </thead> <tbody> <tr> <td style="text-align:center">OpenID</td> <td style="text-align:center">INT</td> <td style="text-align:center">11</td> <td style="text-align:center">是</td> <td style="text-align:center">用户ID</td> </tr> <tr> <td style="text-align:center">nick</td> <td style="text-align:center">String</td> <td style="text-align:center">45</td> <td style="text-align:center">是</td> <td style="text-align:center">用户昵称</td> </tr> <tr> <td style="text-align:center">AccessToken</td> <td style="text-align:center">Object</td> <td style="text-align:center">-</td> <td style="text-align:center">是</td> <td style="text-align:center">AccessToken</td> </tr> <tr> <td style="text-align:center">IsActived</td> <td style="text-align:center">INT</td> <td style="text-align:center">1</td> <td style="text-align:center">是</td> <td style="text-align:center">是否激活 0：未激活，1：已激活</td> </tr> </tbody> </table> <hr> <ul> <li>第13步，返回用户信息，否则登录失败</li></ul> <hr> <h3 id="h3-h5-"><a name="H5授权登录时序图如下：" class="reference-link"></a><span class="header-link octicon octicon-link"></span>二、H5授权登录时序图如下：</h3><hr> <p style="text-align:center"><img src="https://biwan.wanlege.com/source/app/h5-auth.jpg" alt="markdown" title="markdown"> </p><hr> <ul> <li>第5步，使用Code，AccessToken发起登录请求，此处需要第三方服务端实现登录接口;</li></ul> <p>1、接口入参如下：</p> <table> <thead> <tr> <th style="text-align:center">参数</th> <th style="text-align:center">类型</th> <th style="text-align:center">长度</th> <th style="text-align:center">是否必填</th> <th style="text-align:center">备注</th> </tr> </thead> <tbody> <tr> <td style="text-align:center">Code</td> <td style="text-align:center">String</td> <td style="text-align:center">16</td> <td style="text-align:center">是</td> <td style="text-align:center">登录验证码</td> </tr> <tr> <td style="text-align:center">AccessToken</td> <td style="text-align:center">Object</td> <td style="text-align:center">-</td> <td style="text-align:center">是</td> <td style="text-align:center">AccessToken</td> </tr> </tbody> </table> <hr> <ul> <li>第6步，获取用户信息</li></ul> <p>1、接口地址： <a href="https://biwan.wanlege.com/biwan/biwanUser/h5/oauth2/user_info">https://biwan.wanlege.com/biwan/biwanUser/h5/oauth2/user_info</a><br>2、请求方法： POST<br>3、请求参数 </p><table> <thead> <tr> <th style="text-align:center">参数</th> <th style="text-align:center">类型</th> <th style="text-align:center">长度</th> <th style="text-align:center">是否必填</th> <th style="text-align:center">备注</th> </tr> </thead> <tbody> <tr> <td style="text-align:center">Code</td> <td style="text-align:center">String</td> <td style="text-align:center">16</td> <td style="text-align:center">是</td> <td style="text-align:center">登录验证码</td> </tr> <tr> <td style="text-align:center">AccessToken</td> <td style="text-align:center">Object</td> <td style="text-align:center">-</td> <td style="text-align:center">是</td> <td style="text-align:center">AccessToken</td> </tr> </tbody> </table> <p>4、返回参数</p> <ul> <li>code: 0成功，非0失败</li><li>mag: 返回结果描述</li><li>data 数据结构如下：</li></ul> <table> <thead> <tr> <th style="text-align:center">参数</th> <th style="text-align:center">类型</th> <th style="text-align:center">长度</th> <th style="text-align:center">是否必填</th> <th style="text-align:center">备注</th> </tr> </thead> <tbody> <tr> <td style="text-align:center">OpenID</td> <td style="text-align:center">INT</td> <td style="text-align:center">11</td> <td style="text-align:center">是</td> <td style="text-align:center">用户ID</td> </tr> <tr> <td style="text-align:center">nick</td> <td style="text-align:center">String</td> <td style="text-align:center">45</td> <td style="text-align:center">是</td> <td style="text-align:center">用户昵称</td> </tr> <tr> <td style="text-align:center">AccessToken</td> <td style="text-align:center">Object</td> <td style="text-align:center">-</td> <td style="text-align:center">是</td> <td style="text-align:center">AccessToken</td> </tr> <tr> <td style="text-align:center">IsActived</td> <td style="text-align:center">INT</td> <td style="text-align:center">1</td> <td style="text-align:center">是</td> <td style="text-align:center">是否激活 0：未激活，1：已激活</td> </tr> </tbody> </table> <hr> <ul> <li>第8步，返回用户信息，否则登录失败</li></ul> <h2 id="h2-u652Fu4ED8"><a name="支付" class="reference-link"></a><span class="header-link octicon octicon-link"></span>三、支付</h2><h3 id="h3--"><a name="支付时序图如下：" class="reference-link"></a><span class="header-link octicon octicon-link"></span>支付时序图如下：</h3><hr> <p style="text-align:center"><img src="https://biwan.wanlege.com/source/app/pay.jpg" alt="markdown" title="markdown"> </p><hr> <ul> <li>第2步，客户端提交订单信息（包括AccessToken），第三方服务器实现保存订单信息</li></ul> <hr> <ul> <li>第3步，调用统一下单API</li></ul> <p>1、接口地址： <a href="https://biwan.wanlege.com/biwan/biwanUser/comm/pay/unifiedorder">https://biwan.wanlege.com/biwan/biwanUser/comm/pay/unifiedorder</a><br>2、请求方法： POST<br>3、请求参数（签名方法见后面说明） </p><table> <thead> <tr> <th style="text-align:center">参数</th> <th style="text-align:center">类型</th> <th style="text-align:center">长度</th> <th style="text-align:center">是否必填</th> <th style="text-align:center">备注</th> </tr> </thead> <tbody> <tr> <td style="text-align:center">AppID</td> <td style="text-align:center">INT</td> <td style="text-align:center">11</td> <td style="text-align:center">是</td> <td style="text-align:center">应用ID</td> </tr> <tr> <td style="text-align:center">AccessToken</td> <td style="text-align:center">Object</td> <td style="text-align:center">-</td> <td style="text-align:center">是</td> <td style="text-align:center">AccessToken</td> </tr> <tr> <td style="text-align:center">MchID</td> <td style="text-align:center">INT</td> <td style="text-align:center">11</td> <td style="text-align:center">是</td> <td style="text-align:center">商户ID</td> </tr> <tr> <td style="text-align:center">Nonce</td> <td style="text-align:center">String</td> <td style="text-align:center">32</td> <td style="text-align:center">是</td> <td style="text-align:center">随机数</td> </tr> <tr> <td style="text-align:center">ProductID</td> <td style="text-align:center">INT</td> <td style="text-align:center">32</td> <td style="text-align:center">是</td> <td style="text-align:center">产品ID</td> </tr> <tr> <td style="text-align:center">Body</td> <td style="text-align:center">String</td> <td style="text-align:center">255</td> <td style="text-align:center">否</td> <td style="text-align:center">产品描述</td> </tr> <tr> <td style="text-align:center">OutTradeNo</td> <td style="text-align:center">String</td> <td style="text-align:center">45</td> <td style="text-align:center">是</td> <td style="text-align:center">订单号</td> </tr> <tr> <td style="text-align:center">TotalFee</td> <td style="text-align:center">BIGINT</td> <td style="text-align:center">20</td> <td style="text-align:center">是</td> <td style="text-align:center">订单金额，4位精度,例如 70000 代表的是 7 元</td> </tr> <tr> <td style="text-align:center">TimeStart</td> <td style="text-align:center">Date</td> <td style="text-align:center">-</td> <td style="text-align:center">否</td> <td style="text-align:center">订单开始时间</td> </tr> <tr> <td style="text-align:center">TimeExpire</td> <td style="text-align:center">Date</td> <td style="text-align:center">-</td> <td style="text-align:center">否</td> <td style="text-align:center">订单失效时间，默认半个小时</td> </tr> <tr> <td style="text-align:center">NotifyUrl</td> <td style="text-align:center">String</td> <td style="text-align:center">255</td> <td style="text-align:center">是</td> <td style="text-align:center">支付成功回调地址</td> </tr> <tr> <td style="text-align:center">sign</td> <td style="text-align:center">String</td> <td style="text-align:center">32</td> <td style="text-align:center">是</td> <td style="text-align:center">数据签名，加入商户密码的MD5签名</td> </tr> </tbody> </table> <p>4、返回参数</p> <ul> <li>code: 0成功，非0失败</li><li>mag: 返回结果描述</li><li>data 数据结构如下：</li></ul> <table> <thead> <tr> <th style="text-align:center">参数</th> <th style="text-align:center">类型</th> <th style="text-align:center">长度</th> <th style="text-align:center">是否必填</th> <th style="text-align:center">备注</th> </tr> </thead> <tbody> <tr> <td style="text-align:center">PrepayID</td> <td style="text-align:center">INT</td> <td style="text-align:center">11</td> <td style="text-align:center">是</td> <td style="text-align:center">预支付ID</td> </tr> </tbody> </table> <hr> <ul> <li>第6-7步，第三方服务器生成带签名的客户端支付信息，需要第三方在第2步的接口里面组装数据</li></ul> <p>1、返回参数数据结构如下（签名方法见后面说明）：</p> <table> <thead> <tr> <th style="text-align:center">参数</th> <th style="text-align:center">类型</th> <th style="text-align:center">长度</th> <th style="text-align:center">是否必填</th> <th style="text-align:center">备注</th> </tr> </thead> <tbody> <tr> <td style="text-align:center">AppID</td> <td style="text-align:center">INT</td> <td style="text-align:center">11</td> <td style="text-align:center">是</td> <td style="text-align:center">应用ID</td> </tr> <tr> <td style="text-align:center">PrepayID</td> <td style="text-align:center">INT</td> <td style="text-align:center">11</td> <td style="text-align:center">是</td> <td style="text-align:center">预支付ID</td> </tr> <tr> <td style="text-align:center">Nonce</td> <td style="text-align:center">String</td> <td style="text-align:center">32</td> <td style="text-align:center">是</td> <td style="text-align:center">随机数</td> </tr> <tr> <td style="text-align:center">ProductID</td> <td style="text-align:center">INT</td> <td style="text-align:center">32</td> <td style="text-align:center">是</td> <td style="text-align:center">产品ID</td> </tr> <tr> <td style="text-align:center">TimeStamp</td> <td style="text-align:center">Date</td> <td style="text-align:center">-</td> <td style="text-align:center">是</td> <td style="text-align:center">当前时间戳</td> </tr> <tr> <td style="text-align:center">sign</td> <td style="text-align:center">String</td> <td style="text-align:center">32</td> <td style="text-align:center">是</td> <td style="text-align:center">数据签名，加入商户密码的MD5签名</td> </tr> </tbody> </table> <hr> <ul> <li>第8-9步，用户确认支付，第三方客户端调起支付，发起支付请求（此处见SDK 说明）</li></ul> <hr> <p>第13步， 用户确认支付，输入密码，调起SDK验证密码</p> <hr> <p>第16步，第三发服务器收到异步支付结果通知，此处第三方自己实现接口，对应第2步的NotifyUrl字段</p> <p>1、接口接受到的参数</p> <ul> <li>code: 0成功，非0失败</li><li>mag: 返回结果描述</li><li>data 数据结构如下：</li></ul> <table> <thead> <tr> <th style="text-align:center">参数</th> <th style="text-align:center">类型</th> <th style="text-align:center">长度</th> <th style="text-align:center">是否必填</th> <th style="text-align:center">备注</th> </tr> </thead> <tbody> <tr> <td style="text-align:center">PrepayID</td> <td style="text-align:center">INT</td> <td style="text-align:center">11</td> <td style="text-align:center">是</td> <td style="text-align:center">预支付ID</td> </tr> </tbody> </table> <hr> <p>第18步，第三方收到回调通知以后向服务器发送200状态码</p> <hr> <p>第19-21步, 必玩客户端执行回调将支付结果通知第三方APP，第三方APP 向第三方服务器查询自己的订单状态，返回查询接口，此处第三方自己实现</p> <hr> <h4 id="h4--"><a name="签名方法说明：" class="reference-link"></a><span class="header-link octicon octicon-link"></span>签名方法说明：</h4><p>1、 过滤掉对象中的空值和sign、token、key等属性<br>2、 将对象属性按照字典排序<br>3、 将数据属性和值用 “=”连接，中间使用“&amp;”连接键值对；<br>4、 最后加上”&amp;key=” + secret;<br>5、 使用MD5方法对字符串加密，并将签名字符转成大写字符 </p></body> </html>
