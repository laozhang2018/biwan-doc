(function(){var code=null;var accessToken=null;var appid=0;var accessTokenEncoded=null;window.onBYBListner=function(data){if(data.ReqType=="pay")BYBApi.Notification.emit("BYBPaymentCallback",data)};window.BYBApi={scheme:"bybweb://",init:function(id){appid=id;accessToken={};accessTokenEncoded={};if(this.getPara("EncryptKey")!=null){accessToken.EncryptKey=this.getPara("EncryptKey");accessTokenEncoded.EncryptKey=encodeURIComponent(accessToken.EncryptKey)}if(this.getPara("EncryptStr")!=null){accessToken.EncryptStr=this.getPara("EncryptStr");accessTokenEncoded.EncryptStr=encodeURIComponent(accessToken.EncryptStr)}if(this.getPara("Code")!=null)code=this.getPara("Code")},getCode:function(){return code},getAccessToken:function(){return accessToken},getEncodedAccessToken:function(){return accessTokenEncoded},getAppID:function(){return appid},prepare:function(){this.win=window.open()},pay:function(prepayid,nonce,timestamp,sign){var obj={ReqType:"pay",AppID:appid,PrepayID:prepayid,Nonce:nonce,TimeStamp:timestamp,sign:sign};var params=this.trans2formdata(obj);var url=this.scheme+"?"+params;if(this.win!=null)this.win.location=url;else window.open(url)},quit:function(){var url=this.scheme+"?quit";if(this.win!=null)this.win.location=url;else window.open(url)},back:function(){var url=this.scheme+"?back";if(this.win!=null)this.win.location=url;else window.open(url)},getPara:function(name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)","i");var r=window.location.search.substr(1).match(reg);if(r!=null){return unescape(r[2])}return null},trans2formdata:function(data,noslice){var para="";for(var key in data){if(data[key]instanceof Object){para+=HttpUtil.trans2formdata(data[key],true)}else{if(data[key]!=null)para+=key+"="+data[key]+"&"}}if(noslice==null)para=para.slice(0,para.length-1);return para},urlparams2obj:function(paramStr){var obj={};var arr=paramStr.split("&");for(var i=0;i<arr.length;i++){var kv=arr[i].split("=");obj[kv[0]]=kv[1]}return obj}};BYBApi.Notification={_eventMap:[],on:function(type,callback,target){if(this._eventMap[type]===undefined){this._eventMap[type]=[]}this._eventMap[type].push({callback:callback,target:target})},emit:function(type,parameter){var array=this._eventMap[type];if(array===undefined)return;for(var i=0;i<array.length;i++){var element=array[i];if(element)element.callback.call(element.target,parameter)}},off:function(type,callback,target){var array=this._eventMap[type];if(array===undefined)return;for(var i=0;i<array.length;i++){var element=array[i];if(element&&element.callback===callback&&element.target===target){array.splice(i,1);break}}},offType:function(type){this._eventMap[type]=undefined}}})();